services:

  frontend:
    build:
      context: ./frontend/
      dockerfile: Dockerfile.prod
    container_name: frontend
    volumes:
      - /var/www/home:/var/www/home

  nginx:
    image: nginx:latest
    container_name: nginx
    ports:
      - "80:80"
      - "443:443"
    restart: always
    volumes:
      - ./nginx/nginx-prod.conf:/etc/nginx/conf.d/default.conf
      - /etc/letsencrypt/live/gavro.fun/:/etc/letsencrypt/live/gavro.fun/
    depends_on:
      - backend

  backend:
    build:
      context: ./backend/
      dockerfile: Dockerfile.prod
    container_name: api
    volumes:
      - ./backend:/app
    restart: always    
    environment:
      DJANGO_SECRET_KEY: "${DJANGO_SECRET_KEY}"
      DO_ACCESS_KEY_ID: "${DO_ACCESS_KEY_ID}"
      DO_SECRET_ACCESS_KEY: "${DO_SECRET_ACCESS_KEY}"
      DO_BUCKET_NAME: "${DO_BUCKET_NAME}"
      DO_ENDPOINT_URL: "${DO_ENDPOINT_URL}"
      DO_REGION_NAME: "${DO_REGION_NAME}"
      DJANGO_ENABLE_ADMIN: "${DJANGO_ENABLE_ADMIN}"
      DB_USER: "${DB_USER}"
      DB_PASSWORD: "${DB_PASSWORD}"
      DB_HOST: "${DB_HOST}"
      DB_PORT: "${DB_PORT}"
      DB_NAME: "${DB_NAME}"
      DB_CA_CERT_PATH: "${DB_CA_CERT_PATH}"
      DJANGO_SETTINGS_MODULE: "${DJANGO_SETTINGS_MODULE}"

  wordpress:
    image: wordpress:latest
    container_name: blog
    environment:
      WORDPRESS_DB_HOST: "${WP_DB_HOST}"
      WORDPRESS_DB_USER: "${WP_DB_USER}"
      WORDPRESS_DB_PASSWORD: "${WP_DB_PASSWORD}"
      WORDPRESS_DB_NAME: "${WP_DB_NAME}"
      WORDPRESS_TABLE_PREFIX: wp_
    volumes:
      - wordpress_data:/var/www/html

volumes:
  wordpress_data:
